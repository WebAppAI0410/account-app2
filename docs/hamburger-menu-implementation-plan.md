# ハンバーガーメニュー実装計画（最終版）

## 概要

イベント一覧ページですべてのデバイス（モバイル・タブレット・デスクトップ）において、右上にハンバーガーメニューを配置し、クリックすると右側からメニューがスライドインする機能を実装します。また、すべてのデバイスで右下に浮動アクション「+」ボタンを表示します。

スライドインするメニューには以下の項目を含めます：
1. **テーマ切替**: その場でトグルを操作してダークモード/ライトモードを切り替え
2. **使い方**: 使い方のページに遷移
3. **プラン**: プランのページに遷移

## 現状分析

1. 現在の実装の特徴:
   - **モバイル**: 
     - 左上にハンバーガーメニューボタン
     - クリックすると左側からサイドバーが表示
     - 右下に浮動アクション「+」ボタン
   - **タブレット/デスクトップ**: 
     - 左側にサイドバーが常に固定表示
     - サイドバー内に「Create Event」ボタン
     - ハンバーガーメニューなし

2. `SidebarProvider`と`useIsMobile`フックを使用して、デバイスタイプに応じた表示制御が実装されています

3. 現状ではダークモード/ライトモードの切り替え機能は実装されていません

4. 広告バナーは画面下部に固定表示され、コンテンツとの重なりを避けるためのパディングが設定されています:
   - コンテンツエリアには `pb-[60px]`（モバイル用）と `md:pb-[100px]`（タブレット/デスクトップ用）のパディングが設定
   - 浮動アクション「+」ボタンは `bottom-[70px]` に配置され、広告バナーの上に表示

## 実装計画

### 1. すべてのデバイスでハンバーガーメニューを右上に配置

ハンバーガーメニューを左上から右上に移動し、モバイルだけでなくすべてのデバイスで表示するように変更します。

### 2. すべてのデバイスでメニューを右側からスライドインするように変更

現在のタブレット/デスクトップでの固定サイドバーを廃止し、すべてのデバイスでハンバーガーメニューをクリックした時に右側からスライドインするように変更します。

### 3. すべてのデバイスで右下に浮動アクション「+」ボタンを表示

現在モバイルのみに表示されている右下の浮動アクション「+」ボタンを、すべてのデバイスで表示するように変更します。

### 4. メニュー内容の更新と追加機能の実装

スライドインメニューに以下の項目を実装します：

#### 4.1 テーマ切替の実装

- テーマ切替のトグルボタンを追加
- ダークモード/ライトモード切替機能を実装（テーマコンテキストを新規作成）
- トグル状態をローカルストレージに保存し、再訪問時に復元

#### 4.2 使い方ページの実装

- 「使い方」ページへのリンクを追加
- 使い方ページのルートとコンポーネントを作成
- 以下の内容を含める：
  - 基本的な操作方法
  - 主要機能の説明
  - シンプルなレイアウト
- ページ上部に「戻る」ボタンを配置し、イベント一覧ページに戻れるようにする

#### 4.3 プランページの実装

- 「プラン」ページへのリンクを追加
- プランページのルートとコンポーネントを作成
- 以下の内容を含める：
  - 無料版と有料版の機能比較表
  - シンプルなレイアウト
- ページ上部に「戻る」ボタンを配置し、イベント一覧ページに戻れるようにする

### 5. 広告バナーと要素の適切な配置

- 新しく作成するすべてのページで既存のレイアウト構造を利用し、コンテンツが広告と重ならないようにする
- バナーの高さに合わせた下部パディング(`pb-[60px] md:pb-[100px]`)を維持する
- 浮動「+」ボタンの位置(`bottom-[70px]`)を維持し、広告バナーと重ならないようにする
- 適切なz-index階層を維持し、要素が正しく重なるようにする

### 6. UX向上のための追加実装

- サイドバーが開閉する際のスムーズなトランジションアニメーションを追加
- サイドバーが開いている時に背景をオーバーレイで暗くし、メニューに焦点を当てる
- サイドバーを閉じる方法を複数提供（閉じるボタン、背景クリック、ESCキー）
- スワイプジェスチャーでもサイドバーを閉じられるようにする（モバイル向け）

### 7. アクセシビリティ対応

- ハンバーガーメニューボタンに適切な`aria-label`を設定
- キーボードナビゲーションのサポート（Tabキーでメニュー項目間を移動可能に）
- スクリーンリーダー対応のためのセマンティックなマークアップ
- フォーカス管理の実装（メニューが開いた時に最初の項目にフォーカス）

```mermaid
flowchart TB
    subgraph "すべてのデバイス（共通実装）"
        A[右上にハンバーガーメニュー配置] --> B[クリックすると右側からサイドバー表示]
        C[右下に浮動アクション「+」ボタン表示] --> D[クリックするとイベント作成ダイアログを表示]
        
        subgraph "サイドバーメニュー内容"
            E[テーマ切替] --> F[ダークモード/ライトモードトグル]
            G[使い方] --> H[使い方ページへ遷移]
            I[プラン] --> J[プランページへ遷移]
        end
    end
    
    subgraph "ページナビゲーション"
        K[使い方ページ] --> L[上部の「戻る」ボタンでイベント一覧に戻る]
        M[プランページ] --> N[上部の「戻る」ボタンでイベント一覧に戻る]
    end
    
    subgraph "広告バナー対応"
        O[既存のレイアウト構造利用] --> P[コンテンツと広告の重なり防止]
        Q[適切な下部パディング維持] --> R[pb-[60px] md:pb-[100px]]
        S[浮動「+」ボタン位置維持] --> T[bottom-[70px]]
        U[z-index階層の適切な管理] --> V[要素の正しい重なり順]
    end

    subgraph "UX・アクセシビリティ向上"
        W[スムーズなトランジション] --> X[CSSアニメーション追加]
        Y[バックドロップオーバーレイ] --> Z[メニュー開閉時の視覚的フィードバック]
        AA[キーボード操作対応] --> AB[Tabキー・ESCキー対応]
        AC[スクリーンリーダー対応] --> AD[適切なaria属性設定]
    end
```

## 具体的な実装ステップ

1. `src/app/page.tsx` を修正:
   - ハンバーガーメニューボタンのポジショニングを `left-4` から `right-4` に変更
   - `isMobile` 条件分岐を削除し、すべてのデバイスでハンバーガーメニューを表示するようにする
   - 右下の浮動アクション「+」ボタンも同様に、`isMobile` 条件分岐を削除してすべてのデバイスで表示
   - ハンバーガーメニューボタンに適切な `aria-label` を追加（アクセシビリティ向上）

2. `src/components/ui/sidebar.tsx` の修正:
   - すべてのデバイスでサイドバーが右側から表示されるように設定を変更
   - タブレット/デスクトップでの固定サイドバー表示を廃止
   - `side="right"` の設定を追加
   - メニュー開閉時のトランジションアニメーションを追加
   - バックドロップオーバーレイを追加（メニュー開閉時の視覚的フィードバック）
   - キーボードイベントリスナーを追加（ESCキーでメニューを閉じる機能）
   - タッチイベントリスナーを追加（スワイプでメニューを閉じる機能）

3. テーマ切替機能の実装:
   - `src/context/ThemeContext.tsx` を作成し、テーマ状態管理用のコンテキストを実装
   - テーマの変更を検出して適用するカスタムフック `useTheme` を実装
   - トグルボタンコンポーネントを作成（Switch コンポーネントを使用）
   - `localStorage` を使用してテーマ設定を保存（ブラウザ再読み込み後も設定を維持）
   - `localStorage` が利用できない環境のためのフォールバック処理も実装
   - ルートレイアウト（`src/app/layout.tsx`）でテーマプロバイダーを適用
   - CSS変数または Tailwind のダークモードクラスを使用してスタイル切替を実装

4. 共通ヘッダーコンポーネントの作成:
   - `src/components/PageHeader.tsx` を作成
   - 「戻る」ボタンを含むヘッダーコンポーネントを実装
   - アクセシビリティに配慮した適切なマークアップ
   - レスポンシブデザインに対応

5. 新規ページの作成:
   - 使い方ページ (`src/app/how-to/page.tsx`)
     - 共通ヘッダーコンポーネントを使用
     - 基本的な操作方法の説明（イベント作成、参加者追加、費用管理など）
     - シンプルな手順書形式で主要機能の説明
     - スクリーンショットや図解（オプション）
     - 広告バナーの表示領域を考慮した適切な下部パディングを設定
     - SEO対応のメタタグ設定

   - プランページ (`src/app/plans/page.tsx`)
     - 共通ヘッダーコンポーネントを使用
     - 無料版と有料版の機能比較表
     - 料金情報
     - アップグレード方法の説明
     - 広告バナーの表示領域を考慮した適切な下部パディングを設定
     - SEO対応のメタタグ設定

6. サイドバーメニュー内容の更新:
   - テーマ切替トグル（Switch コンポーネント使用）
   - 使い方ページへのリンク（リンクコンポーネント使用）
   - プランページへのリンク（リンクコンポーネント使用）
   - キーボード操作用の `tabIndex` 属性追加
   - スクリーンリーダー用の `aria-*` 属性追加

7. 翻訳ファイル更新:
   - `src/locales/ja.json` に新しい翻訳キーを追加
   - テーマ切替、使い方、プランなどの文言を日本語化
   - エラーメッセージやアクセシビリティテキストの翻訳も追加

8. パフォーマンス最適化:
   - 新規ページはダイナミックインポート（`next/dynamic`）を使用して遅延ロード
   - 画像の最適化（適切なサイズとフォーマット）
   - 不要なレンダリングを防ぐための `React.memo` やメモ化フックの活用

9. テスト:
   - モバイル/タブレット/デスクトップでの表示と動作を確認
   - 各メニュー項目の機能を確認（テーマ切替、ページ遷移）
   - ダークモード/ライトモードの見た目の確認
   - キーボード操作のテスト
   - スクリーンリーダーでの読み上げテスト
   - 広告バナーとコンテンツや操作要素が適切に配置されていることを確認

この実装により、すべてのデバイスで一貫したユーザーインターフェースを提供し、ユーザーはテーマの切り替えや使い方・プラン情報へのアクセスが容易になります。また、アクセシビリティにも配慮したデザインにより、より多くのユーザーが快適にアプリを利用できるようになります。